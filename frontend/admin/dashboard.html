<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Admin Dashboard - Voting App</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="../images/church_logo/award.jpg" />
    <link rel="apple-touch-icon" href="../images/church_logo/award.jpg" />
    
    <!-- Additional Meta -->
    <meta name="theme-color" content="#D4AF37" />
    <meta name="robots" content="noindex, nofollow" />
    
    <link rel="stylesheet" href="dashboard.css">
    <script>
        (function() {
            const localHosts = ["localhost", "127.0.0.1"];
            if (localHosts.includes(window.location.hostname)) {
                window.API_BASE = "http://127.0.0.1:5000";
            } else {
                window.API_BASE = "https://votingapp-1-jwdq.onrender.com";
            }
        })();
    </script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Left Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 5h14M3 10h14M3 15h14"/>
                    </svg>
                </button>
                <h2 class="sidebar-logo">Admin Panel</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-page="dashboard">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="6" height="6" rx="1"/>
                        <rect x="11" y="3" width="6" height="6" rx="1"/>
                        <rect x="3" y="11" width="6" height="6" rx="1"/>
                        <rect x="11" y="11" width="6" height="6" rx="1"/>
                    </svg>
                    <span>Dashboard</span>
                </a>
                <a href="#users" class="nav-item" data-page="users" id="navUsers">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10 10a3 3 0 100-6 3 3 0 000 6z"/>
                        <path d="M10 13c-3.314 0-6 1.343-6 3v1h12v-1c0-1.657-2.686-3-6-3z"/>
                    </svg>
                    <span>Users</span>
                </a>
                <a href="#charts" class="nav-item" data-page="charts">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 15v2a1 1 0 001 1h12a1 1 0 001-1v-2M3 15l4-6 4 4 6-8"/>
                    </svg>
                    <span>Charts</span>
                </a>
                <a href="#votes" class="nav-item" data-page="votes" id="navVotes">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                        <path d="M4 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2H6a2 2 0 01-2-2V5z"/>
                        <path d="M8 10h4"/>
                    </svg>
                    <span>Vote Management</span>
                </a>
                <a href="#registration" class="nav-item" data-page="registration" id="navRegistration">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2z"/>
                        <path d="M7 2l1.5 2H11L12.5 2"/>
                        <path d="M6 9h8M6 13h5"/>
                    </svg>
                    <span>User Management</span>
                </a>
                <a href="#nominees" class="nav-item" data-page="nominees" id="navNominees">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 00-4-4H7a4 4 0 00-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    <span>Nominees</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <button class="nav-item logout-nav" id="sidebarLogoutBtn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 7l5 5-5 5M8 7H3v10h5"/>
                    </svg>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="main-wrapper">
            <!-- Top Header -->
            <header class="top-header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12h18M3 6h18M3 18h18"/>
                        </svg>
                    </button>
                    <div class="search-container">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
                            <circle cx="8" cy="8" r="6"/>
                            <path d="m14 14-3-3"/>
                        </svg>
                        <input type="text" id="globalSearch" class="search-input" placeholder="Search...">
                    </div>
                </div>
                <div class="header-right">
                    <a href="../Chart/index.html" class="header-icon-btn" id="viewChartBtn" title="View Charts">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 15v2a1 1 0 001 1h12a1 1 0 001-1v-2M3 15l4-6 4 4 6-8"/>
                        </svg>
                    </a>
                    <div class="user-profile" id="userProfile">
                        <div class="user-info">
                            <span class="user-name" id="userName">Admin</span>
                            <span class="user-role" id="roleBadge">Admin</span>
                        </div>
                        <button class="user-avatar" id="userAvatarBtn" aria-label="User menu" aria-expanded="false" aria-haspopup="true">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </button>
                        <div class="user-dropdown" id="userDropdown" role="menu" hidden>
                            <button type="button" class="user-dropdown-item" id="headerLogoutBtn" role="menuitem">
                                <svg width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M13 7l5 5-5 5M8 7H3v10h5"/>
                                </svg>
                                <span>Logout</span>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <main class="page-content">
                <!-- Dashboard Page -->
                <div class="page" id="page-dashboard">
                    <div class="page-header">
                        <h1>Dashboard</h1>
                        <p class="page-subtitle">Overview of voting system statistics</p>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card clickable-stat" id="totalUsersCard">
                            <div class="stat-header">
                                <span class="stat-label">Total Users</span>
                                <div class="stat-icon user-icon">üë•</div>
                            </div>
                            <div class="stat-value" id="totalUsers">-</div>
                            <div class="stat-change positive">
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor">
                                    <path d="M6 2v8M2 6l4-4 4 4"/>
                                </svg>
                                <span>Registered users</span>
                            </div>
                        </div>
                        <div class="stat-card clickable-stat" id="totalVotesCard">
                            <div class="stat-header">
                                <span class="stat-label">Total Votes</span>
                                <div class="stat-icon vote-icon">üìä</div>
                            </div>
                            <div class="stat-value" id="totalVotes">-</div>
                            <div class="stat-change positive">
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor">
                                    <path d="M6 2v8M2 6l4-4 4 4"/>
                                </svg>
                                <span>Votes cast</span>
                            </div>
                        </div>
                        <div class="stat-card clickable-stat" id="categoriesCard">
                            <div class="stat-header">
                                <span class="stat-label">Categories</span>
                                <div class="stat-icon category-icon">üìÅ</div>
                            </div>
                            <div class="stat-value" id="totalCategories">11</div>
                            <div class="stat-change">
                                <span>Active categories</span>
                            </div>
                        </div>
                        <div class="stat-card highlight clickable-stat" id="voteDistributionCard">
                            <div class="stat-header">
                                <span class="stat-label">Vote Distribution</span>
                                <div class="stat-icon">üìà</div>
                            </div>
                            <div class="stat-value-small">By Category</div>
                            <div class="stat-chart-preview" id="distributionPreview">
                                <span>Loading...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Category Vote Distribution -->
                    <div class="content-card">
                        <div class="card-header">
                            <h2>Vote Distribution by Category</h2>
                            <p class="card-subtitle">Shows nominees voted vs total nominees per category</p>
                        </div>
                        <div class="card-body">
                            <div class="distribution-chart" id="distributionChart"></div>
                        </div>
                    </div>
                </div>

                <!-- Users Page -->
                <div class="page" id="page-users" style="display: none;">
                    <div class="page-header">
                        <h1>User Management</h1>
                        <p class="page-subtitle">Manage registered users and their data</p>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <div class="search-container-inline">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
                                    <circle cx="8" cy="8" r="6"/>
                                    <path d="m14 14-3-3"/>
                                </svg>
                                <input type="text" id="userSearch" class="search-input-inline" placeholder="Search users by name, email, phone, or access code...">
                            </div>
                            <div class="card-actions">
                                <button class="btn-icon-text" id="refreshUsersBtn">
                                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 9c0 4.4 3.6 8 8 8s8-3.6 8-8-3.6-8-8-8M1 1v4h4"/>
                                    </svg>
                                    <span>Refresh</span>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Access Code</th>
                                            <th>Votes</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTableBody">
                                        <tr><td colspan="6" class="loading">Loading users...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Page -->
                <div class="page" id="page-charts" style="display: none;">
                    <div class="page-header">
                        <h1>Charts & Analytics</h1>
                        <p class="page-subtitle">Visual representation of voting data</p>
                    </div>
                    <div class="content-card">
                        <div class="card-body" style="text-align: center; padding: 40px;">
                            <p style="margin-bottom: 20px;">View detailed charts and analytics</p>
                            <a href="../Chart/index.html" class="btn-primary">Open Charts</a>
                        </div>
                    </div>
                </div>

                <!-- Vote Management Page -->
                <div class="page" id="page-votes" style="display: none;">
                    <div class="page-header">
                        <h1>Vote Management</h1>
                        <p class="page-subtitle">Reset and manage voting data</p>
                    </div>

                    <!-- Voting Session Toggle -->
                    <div class="content-card" style="margin-bottom: 24px;">
                        <div class="card-body">
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px 0;">
                                <div>
                                    <h3 style="margin: 0 0 8px 0; font-size: 18px; color: var(--text);">Voting Session</h3>
                                    <p style="margin: 0; color: var(--text-muted); font-size: 14px;">Control whether users can submit votes</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="votingSessionToggle" />
                                    <span class="toggle-slider"></span>
                                    <span class="toggle-label" id="votingSessionLabel">OFF</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="action-cards-grid">
                        <div class="action-card danger">
                            <div class="action-card-header">
                                <div class="action-icon">üóëÔ∏è</div>
                                <h3>Reset All Votes</h3>
                            </div>
                            <p>Clear all votes across all categories. This action cannot be undone.</p>
                            <button class="btn-danger" id="resetAllVotesBtn">Reset All Votes</button>
                        </div>
                        <div class="action-card warning">
                            <div class="action-card-header">
                                <div class="action-icon">üë§</div>
                                <h3>Reset User Votes</h3>
                            </div>
                            <p>Clear votes for a specific user by entering their database ID or access code.</p>
                            <button class="btn-warning" id="resetUserVotesBtn">Reset User Votes</button>
                        </div>
                        <div class="action-card warning">
                            <div class="action-card-header">
                                <div class="action-icon">üìÅ</div>
                                <h3>Reset Category Votes</h3>
                            </div>
                            <p>Clear all votes for a specific category by entering the category name.</p>
                            <button class="btn-warning" id="resetCategoryVotesBtn">Reset Category Votes</button>
                        </div>
                    </div>

                    <div class="modal" id="resetUserModal" style="display: none;">
                        <div class="modal-content">
                            <h3>Reset User Votes</h3>
                            <p>Enter database ID (numeric) or access code (e.g., KLTZ24) to reset their votes:</p>
                            <input type="text" id="resetUserIdInput" placeholder="User ID or Access Code" class="modal-input">
                            <div class="modal-actions">
                                <button class="btn-primary" id="confirmResetUserBtn">Reset</button>
                                <button class="btn-secondary" id="cancelResetUserBtn">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <div class="modal" id="resetCategoryModal" style="display: none;">
                        <div class="modal-content">
                            <h3>Reset Category Votes</h3>
                            <p>Enter category name (e.g., "PEACEMAKER AWARDS") or category number to reset all votes in that category:</p>
                            <input type="text" id="resetCategoryInput" placeholder="Category Name or Number" class="modal-input">
                            <div class="modal-actions">
                                <button class="btn-primary" id="confirmResetCategoryBtn">Reset</button>
                                <button class="btn-secondary" id="cancelResetCategoryBtn">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Access Code Verification Modal for Voting Toggle -->
                    <div class="modal" id="votingToggleAuthModal" style="display: none;">
                        <div class="modal-content">
                            <h3>Verify Admin Access</h3>
                            <p>Please enter your admin access code to <span id="toggleActionText">toggle</span> the voting session:</p>
                            <div style="position: relative; width: 100%;">
                                <input type="password" id="votingToggleAccessCode" placeholder="Enter admin access code" class="modal-input" maxlength="6" style="text-transform: uppercase; letter-spacing: 2px; font-size: 18px; text-align: center; padding-right: 50px;">
                                <button type="button" id="votingToggleAccessCodeToggle" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 8px; color: var(--text-muted);" aria-label="Show access code">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="votingToggleAccessCodeToggleIcon">
                                        <path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7Z" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                            <div id="votingToggleError" style="color: var(--error); margin-top: 8px; font-size: 14px; display: none;"></div>
                            <div class="modal-actions">
                                <button class="btn-primary" id="confirmVotingToggleBtn">Confirm</button>
                                <button class="btn-secondary" id="cancelVotingToggleBtn">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Registration Management Page -->
                <div class="page" id="page-registration" style="display: none;">
                    <div class="page-header">
                        <h1>User Management</h1>
                        <p class="page-subtitle">Add users to the event registration list</p>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <h2>Add Registration Entry</h2>
                        </div>
                        <div class="card-body">
                            <form id="addRegistrationForm" class="form-inline">
                                <div class="form-group">
                                    <label>First Name</label>
                                    <input type="text" id="registrationFirstName" placeholder="Enter first name" required>
                                </div>
                                <div class="form-group">
                                    <label>Last Name</label>
                                    <input type="text" id="registrationLastName" placeholder="Enter last name" required>
                                </div>
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <div class="phone-group">
                                        <div class="country-code-combo">
                                            <div class="combo-input-wrapper">
                                                <input 
                                                    type="text" 
                                                    id="registrationCountryCodeInput" 
                                                    class="combo-input" 
                                                    placeholder="+234"
                                                    value="+234"
                                                    readonly
                                                    style="cursor: not-allowed;"
                                                />
                                            </div>
                                            <input type="hidden" id="registrationCountryCode" value="+234">
                                        </div>
                                        <input 
                                            type="tel" 
                                            id="registrationPhone" 
                                            class="form-input phone-input" 
                                            placeholder="(812) 345-6789"
                                            required
                                            maxlength="14"
                                        />
                                    </div>
                                </div>
                                <button type="submit" class="btn-primary">Add Registration</button>
                            </form>
                            <p class="form-hint" style="margin-top: 16px;">Entries added here will be available for new user signups immediately.</p>
                        </div>
                    </div>
                    
                    <!-- Delete User Section -->
                    <div class="content-card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h2>Delete Registration Entry</h2>
                        </div>
                        <div class="card-body">
                            <form id="deleteRegistrationForm" class="form-inline">
                                <div class="form-group">
                                    <label>First Name</label>
                                    <input type="text" id="deleteRegistrationFirstName" placeholder="Enter first name" required>
                                </div>
                                <div class="form-group">
                                    <label>Last Name</label>
                                    <input type="text" id="deleteRegistrationLastName" placeholder="Enter last name" required>
                                </div>
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <div class="phone-group">
                                        <div class="country-code-combo">
                                            <div class="combo-input-wrapper">
                                                <input 
                                                    type="text" 
                                                    id="deleteRegistrationCountryCodeInput" 
                                                    class="combo-input" 
                                                    placeholder="+234"
                                                    value="+234"
                                                    readonly
                                                    style="cursor: not-allowed;"
                                                />
                                            </div>
                                            <input type="hidden" id="deleteRegistrationCountryCode" value="+234">
                                        </div>
                                        <input 
                                            type="tel" 
                                            id="deleteRegistrationPhone" 
                                            class="form-input phone-input" 
                                            placeholder="(812) 345-6789"
                                            required
                                            maxlength="14"
                                        />
                                    </div>
                                </div>
                                <button type="submit" class="btn-danger">Delete User</button>
                            </form>
                            <p class="form-hint" style="margin-top: 16px; color: var(--error);">This will permanently remove the user from the registration list and delete their account if it exists.</p>
                        </div>
                    </div>
                </div>

                <!-- Nominees Page -->
                <div class="page" id="page-nominees" style="display: none;">
                    <div class="page-header">
                        <h1>Nominee Management</h1>
                        <p class="page-subtitle">Manage nominees for each category</p>
                    </div>

                    <div class="categories-list" id="categoriesList">
                        <!-- Categories will be loaded dynamically -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- User Details Modal -->
    <div class="modal" id="userDetailsModal" style="display: none;">
        <div class="modal-content">
            <h3>User Details</h3>
            <div id="userDetailsContent"></div>
            <div class="modal-actions">
                <button class="btn-secondary" id="closeUserModalBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Registration Confirmation Modal -->
    <div class="modal" id="addRegistrationConfirmModal" style="display: none;">
        <div class="modal-content">
            <h3>Confirm Add Registration</h3>
            <p id="addRegistrationConfirmMessage">Do you want to add this user to the system?</p>
            <div class="modal-actions">
                <button class="btn-primary" id="confirmAddRegistrationBtn">Confirm</button>
                <button class="btn-secondary" id="cancelAddRegistrationBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Delete Registration Confirmation Modal -->
    <div class="modal" id="deleteRegistrationConfirmModal" style="display: none;">
        <div class="modal-content">
            <h3>Confirm Delete Registration</h3>
            <p id="deleteRegistrationConfirmMessage">Do you want to delete this user from the system?</p>
            <div class="modal-actions">
                <button class="btn-danger" id="confirmDeleteRegistrationBtn">Confirm</button>
                <button class="btn-secondary" id="cancelDeleteRegistrationBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Message Toast -->
    <div class="toast" id="toast"></div>

    <script src="../data/categories.js" defer></script>
    <script src="dashboard.js" defer></script>
</body>
</html>
